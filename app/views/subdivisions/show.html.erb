<div class='breadcrumbs'>
  <ul>
    <% if can? :manage, Subdivision %>
      <li>
        <%= link_to 'Список обеспечивающих кафедр', subdivisions_path %>
      </li>
    <% end %>
    <li>
      <span><%= @subdivision %></span>
    </li>
  </ul>
</div>

<h1><%= @subdivision %></h1>

<%= link_to "Список преподавателей", subdivision_lecturers_path(@subdivision) unless @subdivision.title.match(/факультет/i) %>

<%= render :partial => 'application/warning' %>

<h2>Периоды</h2>

<div class='periods_list'>
  <ul class='list periods'>
    <% @periods.each do |period| %>
      <li>
        <div class='info'>
          <%= link_to "#{period.title}", subdivision_dockets_path(@subdivision, :by_period => period.id) %>
          <% if summary_dockets_links(period).any? %>
            <div class='links_to_file'>
              <%= link_to 'Скачать', '#' %>
              <ul class='links'>
                <%= summary_dockets_links(period).join("\n").html_safe %>
              </ul>
            </div>
          <% end %>
          (<%= period.timescale %>)
        </div>
        <% if @subdivision.dockets.by_period(period.id).unfilled.any? %>
          <span class='filled_dockets'>
            не заполнено
            <%= I18n.t(:dockets, :count => @subdivision.dockets.by_period(period.id).unfilled.count) %> из
            <%= @subdivision.dockets.by_period(period.id).count %>
          </span>
        <% else %>
            все ведомости заполнены
        <% end %>
      </li>
    <% end %>
  </ul>
</div>

<h2>Группы</h2>

<div class='groups_list'>
  <% @periods_with_groups.each do |course, groups| %>
    <span class="course_title"><%= course %> курс</span>
    <ul class="groups <%= course %>_course">
      <% groups.each do |group| %>
        <li>
        <%= link_to group.title, subdivision_period_group_path(@subdivision, Group.newest_period_for(group.title), group.title) %>
        </li>
      <% end %>
    </ul>
  <% end %>
</div>
